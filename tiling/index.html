
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Bengt Ljungquist">
      
      
      
        <link rel="prev" href="../provenance/">
      
      
        <link rel="next" href="../tiling_demo/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>MicroJSON tiling - MicroJSON Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integration-of-tilejson-with-microjson" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MicroJSON Documentation" class="md-header__button md-logo" aria-label="MicroJSON Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MicroJSON Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MicroJSON tiling
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../example/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../pydantic/" class="md-tabs__link">
        
  
  
    
  
  Core Pydantic model

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../provenance/" class="md-tabs__link">
          
  
  
  Extensions

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../about/" class="md-tabs__link">
          
  
  
  About

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/polusai/microjson" class="md-tabs__link">
        
  
  
    
  
  GitHub

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://pypi.org/project/microjson/" class="md-tabs__link">
        
  
  
    
  
  Pypi

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MicroJSON Documentation" class="md-nav__button md-logo" aria-label="MicroJSON Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MicroJSON Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JSON Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create model example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JSON validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metadata example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Pydantic model
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Extensions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Extensions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../provenance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provenance in MicroJSON
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    MicroJSON tiling
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    MicroJSON tiling
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background-of-tilejson" class="md-nav__link">
    <span class="md-ellipsis">
      
        Background of TileJSON
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tilejson-for-microjson-object-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileJSON for MicroJSON Object Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TileJSON for MicroJSON Object Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiscale-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiscale Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#axis-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Axis Object
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic-model-for-tilejson-for-microjson" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydantic Model for TileJSON for MicroJSON
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pydantic Model for TileJSON for MicroJSON">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tilejson" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileJSON
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilemodel.TileJSON" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileJSON
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TileJSON">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tilemodel" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileModel
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilemodel.TileModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TileModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tilelayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileLayer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilemodel.TileLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileLayer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-tiling-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        General tiling requirements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson2vt" class="md-nav__link">
    <span class="md-ellipsis">
      
        MicroJSON2vt
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.microjson2vt.microjson2vt.MicroJsonVt" class="md-nav__link">
    <span class="md-ellipsis">
      
        MicroJsonVt
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.microjson2vt.microjson2vt.MicroJsonVt.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.microjson2vt.microjson2vt.MicroJsonVt.split_tile" class="md-nav__link">
    <span class="md-ellipsis">
      
        split_tile
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tilewriter-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileWriter module
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilewriter" class="md-nav__link">
    <span class="md-ellipsis">
      
        tilewriter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilewriter.TileWriter" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileWriter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TileWriter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microjson.tilewriter.TileWriter.microjson2tiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        microjson2tiles
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilewriter.extract_fields_ranges_enums" class="md-nav__link">
    <span class="md-ellipsis">
      
        extract_fields_ranges_enums
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilewriter.getbounds" class="md-nav__link">
    <span class="md-ellipsis">
      
        getbounds
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tilereader-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileReader module
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilereader" class="md-nav__link">
    <span class="md-ellipsis">
      
        tilereader
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.tilereader.TileReader" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileReader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TileReader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microjson.tilereader.TileReader.tiles2microjson" class="md-nav__link">
    <span class="md-ellipsis">
      
        tiles2microjson
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tilejson-for-microjson-example-with-vector-layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        TileJSON for MicroJSON example with Vector Layers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tiled-binary-tilejson" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tiled binary TileJSON
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tiled-binary-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tiled binary example
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tiled binary example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-of-creating-binary-tiles-from-a-large-microjson-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example of creating binary tiles from a large MicroJSON file
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microjson.examples.tiling.main" class="md-nav__link">
    <span class="md-ellipsis">
      
        main
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tiled-microjson-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tiled MicroJSON Example
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tiled MicroJSON Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-0" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 0
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#level-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Level 2
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tiling_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tiling Demo (Notebook)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About MicroJSON
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration with OME
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/polusai/microjson" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pypi.org/project/microjson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pypi
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="integration-of-tilejson-with-microjson">Integration of TileJSON with MicroJSON</h1>
<h2 id="purpose">Purpose</h2>
<p>This specification outlines how to use TileJSON to integrate tiled MicroJSON data, both in json form as well as binary form. It provides examples of how TileJSON can be used to specify the tiling scheme and zoom levels for MicroJSON data and its binary equievalent. It is based on the <a href="https://github.com/mapbox/tilejson-spec/blob/master/3.0.0/README.md">TileJSON 3.0.0 specification</a>, but extends it by recommending additional properties to enable integration of MicroJSON data and fit purposes of microscopy imaging. The recommendations provided here are not intrinsic to the original TileJSON specification but have been tailored to suit the needs of microscopy metadata annotation and integration with MicroJSON. However, all suggestions are designed to maintain compatibility with the original TileJSON specification.</p>
<h2 id="background-of-tilejson">Background of TileJSON</h2>
<p><a href="https://github.com/mapbox/tilejson-spec/">TileJSON</a> is a widely-used format in mapping applications for specifying tilesets. Developed to streamline the integration of different map layers, TileJSON is essential for ensuring consistency across mapping platforms. It describes tilesets through a JSON object, detailing properties like tile URLs, zoom levels, and spatial coverage.</p>
<h2 id="tilejson-for-microjson-object-structure">TileJSON for MicroJSON Object Structure</h2>
<ul>
<li><strong><code>tilejson</code>:</strong> Specifies the version of the TileJSON spec being used. Required for all TileJSON objects.</li>
<li><strong><code>name</code>:</strong> The name of the tileset. Optional but recommended.</li>
<li><strong><code>description</code>:</strong> Provide a brief description of the tileset. Optional but recommended.</li>
<li><strong><code>version</code>:</strong> The version of the tileset. Optional but recommended.</li>
<li><strong><code>attribution</code>:</strong> A link to the data source or other attribution information, e.g. organisational origin. Optional but recommended.</li>
<li><strong><code>tiles</code>:</strong> Required. The URL pattern for accessing the vector tiles. The  <code>urlbase/{zlvl}/{t}/{c}/{z}/{x}/{y}</code> is the recommended default naming pattern for the tiles, in this order, where <code>urlbase</code> is the base URL (e.g. <code>http://example.com/tiles</code>), <code>{zlvl}</code> is the zoom level, <code>{t}</code> is the tileset timestamp, <code>{c}</code> is the channel, <code>{z}</code> is the z coordinate, and <code>{x}</code> and <code>{y}</code> are the x and y coordinates, respectively. If not using a timestamp, channel, or z coordinate, these can be omitted. The zoom level should always be first.</li>
<li><strong><code>minzoom</code> and <code>maxzoom</code>:</strong> Defines the range of zoom levels for which the tiles are available.</li>
<li><strong><code>bounds</code>:</strong> Optional. Specifies the geometrical bounds included in the tileset. Specified as an array of minimum four numbers in the order <code>[minX, minY, maxX, maxY]</code>, but may include up to a further six numbers for a total of ten, <code>[minT, minC, minZ, minX, minY, maxT, maxC, maxZ, maxX, maxY]</code>, where <code>minT</code> is the minimum tileset timestamp, <code>minC</code> is the minimum channel, <code>minZ</code> is the minimum z coordinate, <code>minX</code> and <code>minY</code> are the minimum x and y coordinates, <code>maxT</code> is the maximum tileset timestamp, <code>maxC</code> is the maximum channel, <code>maxZ</code> is the maximum z coordinate, and <code>maxX</code> and <code>maxY</code> are the maximum x and y coordinates.</li>
<li><strong><code>center</code>:</strong> Optional. Indicates the center and suggested default view of the tileset. Minimum of three numbers in the order <code>[x, y, zoom]</code>, but may include up to a further three numbers for a total of six, <code>[t,c,z,x,y,zoom]</code>, where <code>t</code> is the tileset timestamp, <code>c</code> is the channel, <code>z</code> is the z coordinate, <code>x</code> and <code>y</code> are the x and y coordinates, and <code>zoom</code> is the zoom level. Zoom level should be last.</li>
<li>
<p><strong><code>vector_layers</code>:</strong>  Required. Describes each layer within the vector tiles, and has the following structure:</p>
</li>
<li>
<p><strong><code>id</code>:</strong> Required. A unique identifier for the layer. Required for each layer.</p>
</li>
<li><strong><code>fields</code>:</strong> Required. A list of fields (attributes) and their data types. For MicroJSON, this can either be an empty list, or a simple datatype indicator, that is either of <code>String</code>, <code>Number</code>, or <code>Bool</code>. Complex data types, such as arrays or objects are not allowed.  Required for each layer.</li>
<li><strong><code>fieldranges</code>:</strong> Optional. A dictionary of field names and their ranges. For example, <code>{"label": [0,100], "channel": [0,10]}</code>. Optional.</li>
<li><strong><code>fieldenums</code>:</strong> Optional. A dictionary of field names and their possible values. For example, <code>{"plate": ["A1", "A2", "B1", "B2"], "image": ["image1.tif", "image2.tif", "image3.tif"]}</code>. Optional.</li>
<li><strong><code>fielddescriptions</code>:</strong> Optional. A dictionary of field names and their descriptions. For example, <code>{"plate": "Well plate identifier", "image": "Image filename", "label": "Label identifier", "channel": "Channel identifier"}</code>. Optional.</li>
<li><strong><code>description</code>:</strong> Optional. A brief description of the layer.</li>
<li><strong><code>minzoom</code> and <code>maxzoom</code>:</strong> Optional. The range of zoom levels at which the layer is visible.</li>
<li><strong><code>fillzoom</code>:</strong> Optional. An integer specifying the zoom level from which to generate overzoomed tiles.</li>
<li><strong><code>legend</code>:</strong> Optional. Contains a legend to be displayed with the tileset.</li>
<li><strong><code>multiscale</code>:</strong> Optional. A multiscale object as defined in the section <a href="#multiscale-object">Multiscale Object</a>. If this property is not present, the default coordinate system is assumed to be the same as the image coordinate system, using cartesian coordinates and pixels as units.</li>
<li><strong><code>scale_factor</code>:</strong> Optional. A float specifying the scale factor for the tileset. If not present, the default value of 2 is assumed. Unless the use case requires a different scale factor, it is highly recommended to use the default value, as it is widely supported and assumed by many viewers.</li>
</ul>
<p>The following fields of TileJSON may be used if the use case requires it, and are included here for completeness:</p>
<ul>
<li><strong><code>scheme</code>:</strong> The tiling scheme of the tileset.</li>
<li><strong><code>grids</code>:</strong> The URL pattern for accessing grid data.</li>
<li><strong><code>data</code>:</strong> Optional. The URL pattern for accessing data. Used for GeoJSON originally, which in this specification is replaced by MicroJSON and used in the <code>tiles</code> field.</li>
<li><strong><code>template</code>:</strong> Optional. Contains a mustache template to be used to format data from grids for interaction.</li>
</ul>
<h3 id="multiscale-object">Multiscale Object</h3>
<p>A multiscale object represents the choice of axes (2-5D) and potentially their transformations that should be applied to the numerical data in order to arrive to the actual size of the object described. If the field is present, it MUST have the following properties:</p>
<ul>
<li><code>"axes"</code>: Representing the choice of axes as an array of Axis objects.</li>
</ul>
<p>It may contain either of, but NOT both of the following properties:</p>
<ul>
<li><code>"coordinateTransformations"</code>: Representing the set of coordinate transformations that should be applied to the numerical data in order to arrive to the actual size of the object described. It MUST be an array of objects, each object representing a coordinate transformation. Each object MUST have properties as follows:</li>
<li><code>"type"</code>: Representing the type of the coordinate transformation. Currently supported types are <code>"identity"</code>, <code>"scale"</code>, and <code>"translate"</code>. If the type is <code>"scale"</code>, the object MUST have the property <code>"scale"</code>, representing the scaling factor. It MUST be an array of numbers, with the number of elements equal to the number of axes in the coordinate system. If the type is <code>"translate"</code>, the object MUST have the property <code>"translate"</code>, representing the translation vector. It MUST be an array of numbers, with the number of elements equal to the number of axes in the coordinate system. If the type is <code>"identity"</code>, the object MUST NOT have any other properties.</li>
<li><code>"transformationMatrix"</code>: Representing the transformation matrix from the coordinate system of the image to the coordinate system of the MicroJSON object. It MUST be an array of arrays of numbers, with the number of rows equal to the number of axes in the coordinate system, and the number of columns equal to the number of axes in the image coordinate system. The transformation matrix MUST be invertible.</li>
</ul>
<h3 id="axis-object">Axis Object</h3>
<p>Together with the other axes in the axes array, an axis object represents the coordinate system of the MicroJSON object (2D-5D)
It MUST have the following properties:</p>
<ul>
<li><code>"name"</code>: Representing the name of the axis. It MUST be a string.
It may contain the following properties:</li>
<li><code>"unit"</code>: Representing the units of the corresponding axis of the geometries in the MicroJSON object. It MUST be an array with the elements having any of the following values: <code>[“angstrom", "attometer", "centimeter", "decimeter", "exameter", "femtometer", "foot", "gigameter", "hectometer", "inch", "kilometer", "megameter", "meter", "micrometer", "mile", "millimeter", "nanometer", "parsec", "petameter", "picometer", "terameter", "yard", "yoctometer", "yottameter", "zeptometer", "zettameter“]</code></li>
<li><code>"description"</code>: A string describing the axis.</li>
</ul>
<h2 id="pydantic-model-for-tilejson-for-microjson">Pydantic Model for TileJSON for MicroJSON</h2>
<h3 id="tilejson">TileJSON</h3>


<div class="doc doc-object doc-class">



<a id="microjson.tilemodel.TileJSON"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.RootModel">RootModel</span></code></p>



        <p>The root object of a TileJSON file.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/microjson/tilemodel.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TileJSON</span><span class="p">(</span><span class="n">RootModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The root object of a TileJSON file.&quot;&quot;&quot;</span>

    <span class="n">root</span><span class="p">:</span> <span class="n">TileModel</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div><h3 id="tilemodel">TileModel</h3>


<div class="doc doc-object doc-class">



<a id="microjson.tilemodel.TileModel"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>



        <p>A TileJSON object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tilejson</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The TileJSON version.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tiles</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="pydantic.AnyUrl">AnyUrl</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of tile URLs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The description of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The version of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attribution</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attribution of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The template of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>legend</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The legend of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scheme</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scheme of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grids</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="pydantic.AnyUrl">AnyUrl</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The grids of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="pydantic.AnyUrl">AnyUrl</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>minzoom</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum zoom level of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>maxzoom</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum zoom level of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bounds</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pydantic.conlist">conlist</span>(<span title="float">float</span>, min_length=4, max_length=10)]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bounds of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>center</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pydantic.conlist">conlist</span>(<span title="float">float</span>, min_length=3, max_length=6)]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The center of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fillzoom</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fill zoom level of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_layers</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="microjson.tilemodel.TileLayer" href="#microjson.tilemodel.TileLayer">TileLayer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vector layers of the tileset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/microjson/tilemodel.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TileModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A TileJSON object.</span>

<span class="sd">    Args:</span>
<span class="sd">        tilejson (str): The TileJSON version.</span>
<span class="sd">        tiles (List[Union[Path, AnyUrl]]): The list of tile URLs.</span>
<span class="sd">        name (Optional[str]): The name of the tileset.</span>
<span class="sd">        description (Optional[str]): The description of the tileset.</span>
<span class="sd">        version (Optional[str]): The version of the tileset.</span>
<span class="sd">        attribution (Optional[str]): The attribution of the tileset.</span>
<span class="sd">        template (Optional[str]): The template of the tileset.</span>
<span class="sd">        legend (Optional[str]): The legend of the tileset.</span>
<span class="sd">        scheme (Optional[str]): The scheme of the tileset.</span>
<span class="sd">        grids (Optional[Union[Path, AnyUrl]]): The grids of the tileset.</span>
<span class="sd">        data (Optional[Union[Path, AnyUrl]]): The data of the tileset.</span>
<span class="sd">        minzoom (Optional[int]): The minimum zoom level of the tileset.</span>
<span class="sd">        maxzoom (Optional[int]): The maximum zoom level of the tileset.</span>
<span class="sd">        bounds (Optional[conlist(float, min_length=4, max_length=10)]):</span>
<span class="sd">            The bounds of the tileset.</span>
<span class="sd">        center (Optional[conlist(float, min_length=3, max_length=6)]):</span>
<span class="sd">            The center of the tileset.</span>
<span class="sd">        fillzoom (Optional[int]): The fill zoom level of the tileset.</span>
<span class="sd">        vector_layers (List[TileLayer]): The vector layers of the tileset.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tilejson</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">AnyUrl</span><span class="p">]]</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">legend</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">scheme</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">grids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">AnyUrl</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">AnyUrl</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">minzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">maxzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">bounds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">conlist</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
    <span class="n">center</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">conlist</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">6</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
    <span class="n">fillzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">vector_layers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TileLayer</span><span class="p">]</span>
    <span class="n">multiscale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Multiscale</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">scale_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div><h3 id="tilelayer">TileLayer</h3>


<div class="doc doc-object doc-class">



<a id="microjson.tilemodel.TileLayer"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>



        <p>A vector layer in a TileJSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The unique identifier for the layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fields in the layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>minzoom</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum zoom level for the layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>maxzoom</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum zoom level for the layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A description of the layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fieldranges</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="float">float</span>, <span title="str">str</span>]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ranges of the fields.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fieldenums</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The enums of the fields.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fielddescriptions</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The descriptions of the fields.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/microjson/tilemodel.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TileLayer</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A vector layer in a TileJSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        id (str): The unique identifier for the layer.</span>
<span class="sd">        fields (Union[None, Dict[str, str]]): The fields in the layer.</span>
<span class="sd">        minzoom (Optional[int]): The minimum zoom level for the layer.</span>
<span class="sd">        maxzoom (Optional[int]): The maximum zoom level for the layer.</span>
<span class="sd">        description (Optional[str]): A description of the layer.</span>
<span class="sd">        fieldranges (Optional[Dict[str, List[Union[int, float, str]]]]):</span>
<span class="sd">            The ranges of the fields.</span>
<span class="sd">        fieldenums (Optional[Dict[str, List[str]]]):</span>
<span class="sd">            The enums of the fields.</span>
<span class="sd">        fielddescriptions (Optional[Dict[str, str]]):</span>
<span class="sd">            The descriptions of the fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">minzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">maxzoom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fieldranges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fieldenums</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">fielddescriptions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div><h2 id="general-tiling-requirements">General tiling requirements</h2>
<p>This specification is designed to be compatible with the <a href="https://github.com/mapbox/vector-tile-spec/blob/master/2.1/README.md">Vector Tile Specification</a> and the <a href="https://github.com/mapbox/tilejson-spec/blob/master/3.0.0/README.md">TileJSON 3.0.0 specification</a>. The Vector Tile Specification specifically requires vector tiles to be agnostic of the global coordinate system, and thus followingly each tile has a relative coordinate system, which instead is defined in the TileJSON. Our ambitions in general are to follow the same principles.</p>
<p>One difference is that we here recommend that the file ending for binary tiles is <code>.pbf</code> instead of <code>.mvt</code> to avoid confusion with the Mapbox Vector Tile format. The binary tiles should be encoded in the <a href="https://developers.google.com/protocol-buffers">Protobuf format</a> as defined in the Vector Tile Specification.</p>
<h2 id="microjson2vt">MicroJSON2vt</h2>
<p>The MicroJSON2vt module is a helper module that can be used to convert MicroJSON objects to vector tiles. It is designed to be used in conjunction with the TileJSON for MicroJSON specification, and can be used to generate vector tiles from MicroJSON objects. The module is designed to be compatible with the Vector Tile Specification, and can be used to generate vector tiles in the intermediate vector tile JSON-format, which then, using <code>vt2pbf</code> may be transformed into protobuf. The module is included in the <code>microjson</code> package, and its wrapper function can be imported using the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">microjson</span><span class="w"> </span><span class="kn">import</span> <span class="n">microjson2vt</span>
</code></pre></div>

<p>The module:
</p>


<div class="doc doc-object doc-class">



<a id="microjson.microjson2vt.microjson2vt.MicroJsonVt"></a>
    <div class="doc doc-contents first">



        <p>MicroJsonVt class, which is the main class for generating vector tiles
from MicroJSON data</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/microjson/microjson2vt/microjson2vt.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MicroJsonVt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MicroJsonVt class, which is the main class for generating vector tiles</span>
<span class="sd">    from MicroJSON data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for MicroJsonVt class</span>

<span class="sd">        Args:</span>
<span class="sd">            data (dict): The data to be converted to vector tiles</span>
<span class="sd">            options (dict): The options to be used for generating vector tiles</span>
<span class="sd">            log_level (int): The logging level to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">get_default_options</span><span class="p">()</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">defaults</span>

        <span class="c1"># Validate and resolve tolerance_function</span>
        <span class="n">tolerance_setting</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tolerance_function&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tolerance_setting</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tolerance_setting</span> <span class="ow">in</span> <span class="n">AVAILABLE_TOLERANCE_FUNCTIONS</span><span class="p">:</span>
                <span class="n">options</span><span class="p">[</span><span class="s2">&quot;tolerance_function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AVAILABLE_TOLERANCE_FUNCTIONS</span><span class="p">[</span>
                    <span class="n">tolerance_setting</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid tolerance function key: &#39;</span><span class="si">{</span><span class="n">tolerance_setting</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Available keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">AVAILABLE_TOLERANCE_FUNCTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tolerance_setting</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Option &#39;tolerance_function&#39; must be a callable function or a valid string key.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># If it&#39;s already callable, we use it directly.</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;preprocess data start&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;maxZoom should be in the 0-24 range&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;promoteId&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;generateId&quot;</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;promoteId and generateId cannot be used together.&quot;</span><span class="p">)</span>

        <span class="c1"># projects and adds simplification info</span>
        <span class="c1"># Create a new instance of a CartesianProjector</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="c1"># Create a separate geometry for each zoom level</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">feature</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;geometry_z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">tolerance_func</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;tolerance_function&quot;</span><span class="p">]</span>  <span class="c1"># Resolved above</span>

        <span class="c1"># Simplify features for each zoom level</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Calculate tolerance using the provided or default function</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance_func</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">geometry_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geometry_z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="c1"># check feature type only simplify Polygon</span>
                <span class="k">if</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">iring</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">])):</span>
                        <span class="n">ring</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">][</span><span class="n">iring</span><span class="p">]</span>
                        <span class="c1"># Convert geom to list of [x, y] pairs</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">[</span><span class="n">ring</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ring</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                        <span class="p">]</span>
                        <span class="n">scoords</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
                        <span class="c1"># Check that it has at least 4 pairs of coordinates</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scoords</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="c1"># If not, use the original coordinates</span>
                            <span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">][</span><span class="n">iring</span><span class="p">]</span> <span class="o">=</span> <span class="n">ring</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># flatten the simplified coords</span>
                            <span class="n">simplified_ring</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scoords</span><span class="p">)):</span>
                                <span class="n">simplified_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">simplified_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">simplified_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            <span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">][</span><span class="n">iring</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplified_ring</span>

        <span class="c1"># tiles and tile_coords are part of the public API</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_coords</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># wraps features (ie extreme west and extreme east)</span>
        <span class="c1"># features = wrap(features, options)</span>

        <span class="c1"># start slicing from the top tile down</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">split_tile</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># splits features from a parent tile to sub-tiles.</span>
    <span class="c1"># z, x, and y are the coordinates of the parent tile</span>
    <span class="c1"># cz, cx, and cy are the coordinates of the target tile</span>
    <span class="c1">#</span>
    <span class="c1"># If no target tile is specified, splitting stops when we reach the maximum</span>
    <span class="c1"># zoom or the number of points is low as specified in the options.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">split_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits features from a parent tile to sub-tiles.</span>

<span class="sd">        Args:</span>
<span class="sd">            features (list): The features to be split</span>
<span class="sd">            z (int): The zoom level of the parent tile</span>
<span class="sd">            x (int): The x coordinate of the parent tile</span>
<span class="sd">            y (int): The y coordinate of the parent tile</span>
<span class="sd">            cz (int): The zoom level of the target tile</span>
<span class="sd">            cx (int): The x coordinate of the target tile</span>
<span class="sd">            cy (int): The y coordinate of the target tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="c1"># avoid recursion by using a processing queue</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">z2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">z</span>
            <span class="n">id_</span> <span class="o">=</span> <span class="n">to_Id</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Use simplified geometries for this zoom level</span>
                <span class="n">simplified_features</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="o">**</span><span class="n">feature</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;geometry_z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]}</span>
                    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span>
                <span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_tile</span><span class="p">(</span><span class="n">simplified_features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
                <span class="n">tile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tile_coords</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># save reference to original geometry in tile so that we can drill</span>
            <span class="c1"># down later if we stop now</span>
            <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>

            <span class="c1"># if it&#39;s the first-pass tiling</span>
            <span class="k">if</span> <span class="n">cz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># stop tiling if we reached max zoom, or if the tile is too</span>
                <span class="c1"># simple</span>
                <span class="k">if</span> <span class="n">z</span> <span class="o">==</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexMaxZoom&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;numPoints&quot;</span>
                <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexMaxPoints&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>  <span class="c1"># if a drilldown to a specific tile</span>
            <span class="k">elif</span> <span class="n">z</span> <span class="o">==</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">==</span> <span class="n">cz</span><span class="p">:</span>
                <span class="c1"># stop tiling if we reached base zoom or our target tile zoom</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">cz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># stop tiling if it&#39;s not an ancestor of the target tile</span>
                <span class="n">zoomSteps</span> <span class="o">=</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">z</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="p">(</span><span class="n">cx</span> <span class="o">&gt;&gt;</span> <span class="n">zoomSteps</span><span class="p">)</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">!=</span> <span class="p">(</span><span class="n">cy</span> <span class="o">&gt;&gt;</span> <span class="n">zoomSteps</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="c1"># if we slice further down, no need to keep source geometry</span>
            <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">features</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;clipping start&quot;</span><span class="p">)</span>

            <span class="c1"># values we&#39;ll use for clipping</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;buffer&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">)</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">k1</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">k1</span>
            <span class="n">k4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k1</span>

            <span class="n">tl</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">bl</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">br</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">left</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                <span class="n">features</span><span class="p">,</span>
                <span class="n">z2</span><span class="p">,</span>
                <span class="n">x</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span>
                <span class="n">x</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minX&quot;</span><span class="p">],</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxX&quot;</span><span class="p">],</span>
                <span class="n">options</span><span class="p">,</span>
                <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                <span class="n">features</span><span class="p">,</span>
                <span class="n">z2</span><span class="p">,</span>
                <span class="n">x</span> <span class="o">+</span> <span class="n">k2</span><span class="p">,</span>
                <span class="n">x</span> <span class="o">+</span> <span class="n">k4</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minX&quot;</span><span class="p">],</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxX&quot;</span><span class="p">],</span>
                <span class="n">options</span><span class="p">,</span>
                <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">features</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tl</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                    <span class="n">left</span><span class="p">,</span>
                    <span class="n">z2</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                    <span class="n">options</span><span class="p">,</span>
                    <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">bl</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                    <span class="n">left</span><span class="p">,</span>
                    <span class="n">z2</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">+</span> <span class="n">k2</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">+</span> <span class="n">k4</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                    <span class="n">options</span><span class="p">,</span>
                    <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">left</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tr</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                    <span class="n">right</span><span class="p">,</span>
                    <span class="n">z2</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                    <span class="n">options</span><span class="p">,</span>
                    <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">br</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                    <span class="n">right</span><span class="p">,</span>
                    <span class="n">z2</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">+</span> <span class="n">k2</span><span class="p">,</span>
                    <span class="n">y</span> <span class="o">+</span> <span class="n">k4</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                    <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                    <span class="n">options</span><span class="p">,</span>
                    <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">right</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;clipping ended&quot;</span><span class="p">)</span>

            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tl</span> <span class="k">if</span> <span class="n">tl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bl</span> <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span> <span class="k">if</span> <span class="n">tr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">br</span> <span class="k">if</span> <span class="n">br</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">z2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">z</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">z2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># wrap tile x coordinate</span>

        <span class="n">id_</span> <span class="o">=</span> <span class="n">to_Id</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">current_tile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_tile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">transform_tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">id_</span><span class="p">],</span> <span class="n">extent</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;drilling down to z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">z0</span> <span class="o">=</span> <span class="n">z</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">z0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z0</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_Id</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># if we found a parent tile containing the original geometry, we can</span>
        <span class="c1"># drill down from it</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;found parent tile z</span><span class="si">{</span><span class="n">z0</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">y0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;drilling down start&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">split_tile</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">),</span> <span class="n">z0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;drilling down end&quot;</span><span class="p">)</span>

        <span class="n">transformed</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">transform_tile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">id_</span><span class="p">],</span> <span class="n">extent</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">transformed</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="microjson.microjson2vt.microjson2vt.MicroJsonVt.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Constructor for MicroJsonVt class</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to be converted to vector tiles</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The options to be used for generating vector tiles</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_level</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The logging level to be used</p>
              </div>
            </td>
            <td>
                  <code><span title="logging.INFO">INFO</span></code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/microjson2vt/microjson2vt.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor for MicroJsonVt class</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): The data to be converted to vector tiles</span>
<span class="sd">        options (dict): The options to be used for generating vector tiles</span>
<span class="sd">        log_level (int): The logging level to be used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="n">get_default_options</span><span class="p">()</span>
    <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">defaults</span>

    <span class="c1"># Validate and resolve tolerance_function</span>
    <span class="n">tolerance_setting</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tolerance_function&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tolerance_setting</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tolerance_setting</span> <span class="ow">in</span> <span class="n">AVAILABLE_TOLERANCE_FUNCTIONS</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;tolerance_function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AVAILABLE_TOLERANCE_FUNCTIONS</span><span class="p">[</span>
                <span class="n">tolerance_setting</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid tolerance function key: &#39;</span><span class="si">{</span><span class="n">tolerance_setting</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Available keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">AVAILABLE_TOLERANCE_FUNCTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tolerance_setting</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Option &#39;tolerance_function&#39; must be a callable function or a valid string key.&quot;</span>
        <span class="p">)</span>
    <span class="c1"># If it&#39;s already callable, we use it directly.</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;preprocess data start&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;maxZoom should be in the 0-24 range&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;promoteId&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;generateId&quot;</span><span class="p">,</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;promoteId and generateId cannot be used together.&quot;</span><span class="p">)</span>

    <span class="c1"># projects and adds simplification info</span>
    <span class="c1"># Create a new instance of a CartesianProjector</span>

    <span class="n">features</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="c1"># Create a separate geometry for each zoom level</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">feature</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;geometry_z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">tolerance_func</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;tolerance_function&quot;</span><span class="p">]</span>  <span class="c1"># Resolved above</span>

    <span class="c1"># Simplify features for each zoom level</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Calculate tolerance using the provided or default function</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance_func</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">geometry_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;geometry_z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># check feature type only simplify Polygon</span>
            <span class="k">if</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iring</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">])):</span>
                    <span class="n">ring</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">][</span><span class="n">iring</span><span class="p">]</span>
                    <span class="c1"># Convert geom to list of [x, y] pairs</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">ring</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ring</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">scoords</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
                    <span class="c1"># Check that it has at least 4 pairs of coordinates</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scoords</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="c1"># If not, use the original coordinates</span>
                        <span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">][</span><span class="n">iring</span><span class="p">]</span> <span class="o">=</span> <span class="n">ring</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># flatten the simplified coords</span>
                        <span class="n">simplified_ring</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scoords</span><span class="p">)):</span>
                            <span class="n">simplified_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">simplified_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">simplified_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">feature</span><span class="p">[</span><span class="n">geometry_key</span><span class="p">][</span><span class="n">iring</span><span class="p">]</span> <span class="o">=</span> <span class="n">simplified_ring</span>

    <span class="c1"># tiles and tile_coords are part of the public API</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tile_coords</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># wraps features (ie extreme west and extreme east)</span>
    <span class="c1"># features = wrap(features, options)</span>

    <span class="c1"># start slicing from the top tile down</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_tile</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="microjson.microjson2vt.microjson2vt.MicroJsonVt.split_tile" class="doc doc-heading">
            <code class=" language-python"><span class="n">split_tile</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cy</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Splits features from a parent tile to sub-tiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The features to be split</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The zoom level of the parent tile</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x coordinate of the parent tile</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y coordinate of the parent tile</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cz</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The zoom level of the target tile</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x coordinate of the target tile</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cy</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y coordinate of the target tile</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/microjson2vt/microjson2vt.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">split_tile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits features from a parent tile to sub-tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        features (list): The features to be split</span>
<span class="sd">        z (int): The zoom level of the parent tile</span>
<span class="sd">        x (int): The x coordinate of the parent tile</span>
<span class="sd">        y (int): The y coordinate of the parent tile</span>
<span class="sd">        cz (int): The zoom level of the target tile</span>
<span class="sd">        cx (int): The x coordinate of the target tile</span>
<span class="sd">        cy (int): The y coordinate of the target tile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
    <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
    <span class="c1"># avoid recursion by using a processing queue</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">z2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">z</span>
        <span class="n">id_</span> <span class="o">=</span> <span class="n">to_Id</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">tile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use simplified geometries for this zoom level</span>
            <span class="n">simplified_features</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span><span class="o">**</span><span class="n">feature</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;geometry_z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]}</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span>
            <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_tile</span><span class="p">(</span><span class="n">simplified_features</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_coords</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;z</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># save reference to original geometry in tile so that we can drill</span>
        <span class="c1"># down later if we stop now</span>
        <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>

        <span class="c1"># if it&#39;s the first-pass tiling</span>
        <span class="k">if</span> <span class="n">cz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># stop tiling if we reached max zoom, or if the tile is too</span>
            <span class="c1"># simple</span>
            <span class="k">if</span> <span class="n">z</span> <span class="o">==</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexMaxZoom&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;numPoints&quot;</span>
            <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;indexMaxPoints&quot;</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># if a drilldown to a specific tile</span>
        <span class="k">elif</span> <span class="n">z</span> <span class="o">==</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxZoom&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">==</span> <span class="n">cz</span><span class="p">:</span>
            <span class="c1"># stop tiling if we reached base zoom or our target tile zoom</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">cz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># stop tiling if it&#39;s not an ancestor of the target tile</span>
            <span class="n">zoomSteps</span> <span class="o">=</span> <span class="n">cz</span> <span class="o">-</span> <span class="n">z</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="p">(</span><span class="n">cx</span> <span class="o">&gt;&gt;</span> <span class="n">zoomSteps</span><span class="p">)</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">!=</span> <span class="p">(</span><span class="n">cy</span> <span class="o">&gt;&gt;</span> <span class="n">zoomSteps</span><span class="p">):</span>
                <span class="k">continue</span>

        <span class="c1"># if we slice further down, no need to keep source geometry</span>
        <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">features</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;clipping start&quot;</span><span class="p">)</span>

        <span class="c1"># values we&#39;ll use for clipping</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;buffer&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">)</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">k1</span>
        <span class="n">k3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">k1</span>
        <span class="n">k4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k1</span>

        <span class="n">tl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">bl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">br</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">left</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span>
            <span class="n">z2</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minX&quot;</span><span class="p">],</span>
            <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxX&quot;</span><span class="p">],</span>
            <span class="n">options</span><span class="p">,</span>
            <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span>
            <span class="n">z2</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">k2</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">k4</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minX&quot;</span><span class="p">],</span>
            <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxX&quot;</span><span class="p">],</span>
            <span class="n">options</span><span class="p">,</span>
            <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                <span class="n">left</span><span class="p">,</span>
                <span class="n">z2</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                <span class="n">options</span><span class="p">,</span>
                <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">bl</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                <span class="n">left</span><span class="p">,</span>
                <span class="n">z2</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">k2</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">k4</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                <span class="n">options</span><span class="p">,</span>
                <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">left</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                <span class="n">right</span><span class="p">,</span>
                <span class="n">z2</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">-</span> <span class="n">k1</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                <span class="n">options</span><span class="p">,</span>
                <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span>
                <span class="n">right</span><span class="p">,</span>
                <span class="n">z2</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">k2</span><span class="p">,</span>
                <span class="n">y</span> <span class="o">+</span> <span class="n">k4</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;minY&quot;</span><span class="p">],</span>
                <span class="n">tile</span><span class="p">[</span><span class="s2">&quot;maxY&quot;</span><span class="p">],</span>
                <span class="n">options</span><span class="p">,</span>
                <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">right</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;clipping ended&quot;</span><span class="p">)</span>

        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tl</span> <span class="k">if</span> <span class="n">tl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bl</span> <span class="k">if</span> <span class="n">bl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span> <span class="k">if</span> <span class="n">tr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">br</span> <span class="k">if</span> <span class="n">br</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="tilewriter-module">TileWriter module</h2>
<p>The TileWriter module is a helper module that can be used to generate binary tiles from a large MicroJSON file, my utilizing both microjson2vt and vt2pbf.
</p>


<div class="doc doc-object doc-module">



<a id="microjson.tilewriter"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="microjson.tilewriter.TileWriter" class="doc doc-heading">
            <code>TileWriter</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="microjson.tilehandler.TileHandler">TileHandler</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/microjson/tilewriter.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TileWriter</span><span class="p">(</span><span class="n">TileHandler</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">microjson2tiles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">microjson_data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">tolerance_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate tiles in form of JSON or PBF files from MicroJSON data.</span>

<span class="sd">        Args:</span>
<span class="sd">            microjson_data_path (Union[str, Path]): Path to the</span>
<span class="sd">            MicroJSON data file</span>
<span class="sd">            validate (bool): Flag to indicate whether to validate</span>
<span class="sd">            the MicroJSON data</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of paths to the generated tiles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">save_tile</span><span class="p">(</span><span class="n">tile_data</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tiles_path_template</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Save a single tile to a file based on the template path.</span>

<span class="sd">            Args:</span>
<span class="sd">                tile_data: The tile data to save</span>
<span class="sd">                z: The zoom level of the tile</span>
<span class="sd">                x: The x coordinate of the tile</span>
<span class="sd">                y: The y coordinate of the tile</span>
<span class="sd">                tiles_path_template: The template path for the tiles</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: The path to the saved tile</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Format the path template with actual tile coordinates</span>
            <span class="n">tile_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tiles_path_template</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tile_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Save the tile data (this assumes tile_data is already in the</span>
            <span class="c1"># correct format, e.g., PBF or JSON)</span>
            <span class="k">if</span> <span class="n">tile_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">):</span>
                <span class="n">tile_data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">tile_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tile_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span> <span class="k">if</span> <span class="n">tile_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pbf&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

            <span class="c1"># return the path to the saved tile</span>
            <span class="k">return</span> <span class="n">tile_path</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">convert_id_to_int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Convert all id fields in the data to integers</span>

<span class="sd">            Args:</span>
<span class="sd">                data: The data to convert</span>

<span class="sd">            Returns:</span>
<span class="sd">                dict: The data with all id fields converted to integers</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># check if data is a list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">convert_id_to_int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="c1"># check if data is a dict</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">while</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_set</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">convert_id_to_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                            <span class="n">convert_id_to_int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Load the MicroJSON data</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">microjson_data_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">microjson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Validate the MicroJSON data</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">MicroJSON</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">microjson_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MicroJSON data validation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># TODO currently only supports one tile layer</span>
        <span class="c1"># calculate maxzoom and minzoom from layer and global tilejson</span>

        <span class="n">maxzoom</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">vector_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxzoom</span>
        <span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">minzoom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">minzoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">vector_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minzoom</span>
        <span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Options for geojson2vt from TileJSON</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;maxZoom&quot;</span><span class="p">:</span> <span class="n">maxzoom</span><span class="p">,</span>  <span class="c1"># max zoom in the final tileset</span>
            <span class="s2">&quot;indexMaxZoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span><span class="p">,</span>  <span class="c1"># tile index max zoom</span>
            <span class="s2">&quot;indexMaxPoints&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max number of points per tile, 0 if none</span>
            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
            <span class="s2">&quot;tolerance_function&quot;</span><span class="p">:</span> <span class="n">tolerance_key</span><span class="p">,</span>  <span class="c1"># Pass the string key</span>
        <span class="p">}</span>

        <span class="c1"># Convert GeoJSON to intermediate vector tiles</span>
        <span class="n">tile_index</span> <span class="o">=</span> <span class="n">microjson2vt</span><span class="p">(</span><span class="n">microjson_data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="c1"># Placeholder for the tile paths</span>
        <span class="n">generated_tiles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># get tilepath from tilejson self.tile_json.tiles</span>
        <span class="c1"># extract the folder from the filepath</span>

        <span class="k">for</span> <span class="n">tileno</span> <span class="ow">in</span> <span class="n">tile_index</span><span class="o">.</span><span class="n">tiles</span><span class="p">:</span>
            <span class="n">atile</span> <span class="o">=</span> <span class="n">tile_index</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">tileno</span><span class="p">]</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">atile</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">atile</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">atile</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
            <span class="c1"># if z is less than minzoom, or greater than maxzoom, skip the tile</span>
            <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="n">minzoom</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="n">maxzoom</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">tile_index</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

            <span class="c1"># add name to the tile_data</span>
            <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tile&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbf</span><span class="p">:</span>
                <span class="c1"># Using vt2pbf to encode tile data to PBF</span>
                <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">vt2pbf</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parquet</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

                <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

                <span class="c1"># drop metadata columns</span>
                <span class="n">encoded_data</span><span class="p">[</span><span class="s2">&quot;new_geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoded_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">encoded_data</span><span class="p">[[</span><span class="s2">&quot;new_geometry&quot;</span><span class="p">]]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

            <span class="n">generated_tiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">save_tile</span><span class="p">(</span><span class="n">encoded_data</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">generated_tiles</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="microjson.tilewriter.TileWriter.microjson2tiles" class="doc doc-heading">
            <code class=" language-python"><span class="n">microjson2tiles</span><span class="p">(</span><span class="n">microjson_data_path</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tolerance_key</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate tiles in form of JSON or PBF files from MicroJSON data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>microjson_data_path</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to indicate whether to validate</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: List of paths to the generated tiles</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/tilewriter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">microjson2tiles</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">microjson_data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">tolerance_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate tiles in form of JSON or PBF files from MicroJSON data.</span>

<span class="sd">    Args:</span>
<span class="sd">        microjson_data_path (Union[str, Path]): Path to the</span>
<span class="sd">        MicroJSON data file</span>
<span class="sd">        validate (bool): Flag to indicate whether to validate</span>
<span class="sd">        the MicroJSON data</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: List of paths to the generated tiles</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_tile</span><span class="p">(</span><span class="n">tile_data</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tiles_path_template</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a single tile to a file based on the template path.</span>

<span class="sd">        Args:</span>
<span class="sd">            tile_data: The tile data to save</span>
<span class="sd">            z: The zoom level of the tile</span>
<span class="sd">            x: The x coordinate of the tile</span>
<span class="sd">            y: The y coordinate of the tile</span>
<span class="sd">            tiles_path_template: The template path for the tiles</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The path to the saved tile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Format the path template with actual tile coordinates</span>
        <span class="n">tile_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tiles_path_template</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tile_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save the tile data (this assumes tile_data is already in the</span>
        <span class="c1"># correct format, e.g., PBF or JSON)</span>
        <span class="k">if</span> <span class="n">tile_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">):</span>
            <span class="n">tile_data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">tile_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tile_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span> <span class="k">if</span> <span class="n">tile_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pbf&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

        <span class="c1"># return the path to the saved tile</span>
        <span class="k">return</span> <span class="n">tile_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_id_to_int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert all id fields in the data to integers</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The data to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The data with all id fields converted to integers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if data is a list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">convert_id_to_int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="c1"># check if data is a dict</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_set</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_counter</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">id_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">convert_id_to_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">convert_id_to_int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Load the MicroJSON data</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">microjson_data_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">microjson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="c1"># Validate the MicroJSON data</span>
    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">MicroJSON</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">microjson_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MicroJSON data validation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># TODO currently only supports one tile layer</span>
    <span class="c1"># calculate maxzoom and minzoom from layer and global tilejson</span>

    <span class="n">maxzoom</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">vector_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxzoom</span>
    <span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="n">minzoom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">minzoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">vector_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minzoom</span>
    <span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="c1"># Options for geojson2vt from TileJSON</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;maxZoom&quot;</span><span class="p">:</span> <span class="n">maxzoom</span><span class="p">,</span>  <span class="c1"># max zoom in the final tileset</span>
        <span class="s2">&quot;indexMaxZoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span><span class="p">,</span>  <span class="c1"># tile index max zoom</span>
        <span class="s2">&quot;indexMaxPoints&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max number of points per tile, 0 if none</span>
        <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
        <span class="s2">&quot;tolerance_function&quot;</span><span class="p">:</span> <span class="n">tolerance_key</span><span class="p">,</span>  <span class="c1"># Pass the string key</span>
    <span class="p">}</span>

    <span class="c1"># Convert GeoJSON to intermediate vector tiles</span>
    <span class="n">tile_index</span> <span class="o">=</span> <span class="n">microjson2vt</span><span class="p">(</span><span class="n">microjson_data</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="c1"># Placeholder for the tile paths</span>
    <span class="n">generated_tiles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># get tilepath from tilejson self.tile_json.tiles</span>
    <span class="c1"># extract the folder from the filepath</span>

    <span class="k">for</span> <span class="n">tileno</span> <span class="ow">in</span> <span class="n">tile_index</span><span class="o">.</span><span class="n">tiles</span><span class="p">:</span>
        <span class="n">atile</span> <span class="o">=</span> <span class="n">tile_index</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="n">tileno</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">atile</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">atile</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">atile</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
        <span class="c1"># if z is less than minzoom, or greater than maxzoom, skip the tile</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="n">minzoom</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="n">maxzoom</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">tile_data</span> <span class="o">=</span> <span class="n">tile_index</span><span class="o">.</span><span class="n">get_tile</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

        <span class="c1"># add name to the tile_data</span>
        <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tile&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbf</span><span class="p">:</span>
            <span class="c1"># Using vt2pbf to encode tile data to PBF</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">vt2pbf</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parquet</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

            <span class="c1"># drop metadata columns</span>
            <span class="n">encoded_data</span><span class="p">[</span><span class="s2">&quot;new_geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoded_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">encoded_data</span><span class="p">[[</span><span class="s2">&quot;new_geometry&quot;</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

        <span class="n">generated_tiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">save_tile</span><span class="p">(</span><span class="n">encoded_data</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">generated_tiles</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="microjson.tilewriter.extract_fields_ranges_enums" class="doc doc-heading">
            <code class=" language-python"><span class="n">extract_fields_ranges_enums</span><span class="p">(</span><span class="n">microjson_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract field names, ranges, and enums from the provided MicroJSON
file.
Returns:
    tuple: (dict with field names and types,
            dict of field ranges,
            dict of field enums)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/tilewriter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_fields_ranges_enums</span><span class="p">(</span><span class="n">microjson_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract field names, ranges, and enums from the provided MicroJSON</span>
<span class="sd">    file.</span>
<span class="sd">    Returns:</span>
<span class="sd">        tuple: (dict with field names and types,</span>
<span class="sd">                dict of field ranges,</span>
<span class="sd">                dict of field enums)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_json_type</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Set to String if None</span>
            <span class="k">return</span> <span class="s2">&quot;String&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Boolean&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;Number&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Object&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Array&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;String&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">microjson_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">field_names</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">field_ranges</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">field_enums</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_names</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">field_names</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_json_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_ranges</span><span class="p">:</span>
                    <span class="n">field_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">field_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
                    <span class="n">field_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">field_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_enums</span><span class="p">:</span>
                    <span class="n">field_enums</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">field_enums</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">field_ranges</span><span class="p">,</span> <span class="n">field_enums</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="microjson.tilewriter.getbounds" class="doc doc-heading">
            <code class=" language-python"><span class="n">getbounds</span><span class="p">(</span><span class="n">microjson_file</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the max and min bounds for coordinates of the MicroJSON file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>microjson_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the MicroJSON file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>square</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to indicate whether to return square bounds</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: List of the bounds [minx, miny, maxx, maxy]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/tilewriter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getbounds</span><span class="p">(</span><span class="n">microjson_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">square</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the max and min bounds for coordinates of the MicroJSON file</span>

<span class="sd">    Args:</span>
<span class="sd">        microjson_file (str): Path to the MicroJSON file</span>
<span class="sd">        square (bool): Flag to indicate whether to return square bounds</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: List of the bounds [minx, miny, maxx, maxy]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">microjson_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="c1"># get the bounds</span>
    <span class="n">minx</span> <span class="o">=</span> <span class="n">miny</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">maxy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ring</span><span class="p">:</span>
                            <span class="n">minx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">miny</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxy</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ring</span><span class="p">:</span>
                                <span class="n">minx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">miny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">miny</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="n">maxx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">maxy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxy</span><span class="p">,</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">square</span><span class="p">:</span>
        <span class="n">side</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">side</span> <span class="o">+</span> <span class="n">minx</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">side</span> <span class="o">+</span> <span class="n">miny</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>An example of how to use the TileWriter module is located in the <code>src/microjson/examples/tiling.py</code> file of the repository. The example demonstrates how to generate binary tiles from a large MicroJSON file.</p>
<h2 id="tilereader-module">TileReader module</h2>
<p>Correspondingly, the TileReader module is a helper module that can be used to read binary tiles and convert them back to MicroJSON objects.
</p>


<div class="doc doc-object doc-module">



<a id="microjson.tilereader"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="microjson.tilereader.TileReader" class="doc doc-heading">
            <code>TileReader</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="microjson.tilehandler.TileHandler">TileHandler</span></code></p>



        <p>Class to read tiles and generate MicroJSON data</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/microjson/tilereader.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TileReader</span><span class="p">(</span><span class="n">TileHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to read tiles and generate MicroJSON data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tiles2microjson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zlvl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate MicroJSON data from tiles in form of JSON or PBF files.</span>
<span class="sd">        Get the TileJSON configuration and the PBF flag from the class</span>
<span class="sd">        attributes.</span>
<span class="sd">        Check that zlvl is within the maxzoom and minzoom of the tilejson</span>
<span class="sd">        Get the bounds from the tilejson and use to generate the MicroJSON</span>
<span class="sd">        data, by reading the tiles at the specified zoom level and</span>
<span class="sd">        extracting the geometries from the tiles.</span>

<span class="sd">        Args:</span>
<span class="sd">            zlvl (int): The zoom level of the tiles to read</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The generated MicroJSON data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if zlvl is within the maxzoom and minzoom of the tilejson</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">minzoom</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">zlvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">minzoom</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">zlvl</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># get the bounds from the tilejson</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">minx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ntiles</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">zlvl</span>
        <span class="n">xstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)</span> <span class="o">/</span> <span class="n">ntiles</span>
        <span class="n">ystep</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span> <span class="o">/</span> <span class="n">ntiles</span>
        <span class="n">xstarts</span> <span class="o">=</span> <span class="p">[</span><span class="n">minx</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">xstep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>
        <span class="n">ystarts</span> <span class="o">=</span> <span class="p">[</span><span class="n">miny</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">ystep</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>
        <span class="n">xstops</span> <span class="o">=</span> <span class="p">[</span><span class="n">minx</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">xstep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>
        <span class="n">ystops</span> <span class="o">=</span> <span class="p">[</span><span class="n">miny</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ystep</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>

        <span class="c1"># reverse the ystarts and ystops</span>
        <span class="c1"># ystarts = ystarts[::-1]</span>
        <span class="c1"># ystops = ystops[::-1]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">extent</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">xmin</span><span class="p">),</span>
                <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">extent</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="n">ymin</span><span class="p">),</span>
            <span class="p">]</span>

        <span class="c1"># get the tilepath from the tilejson</span>
        <span class="n">tilepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># initialize the microjson data</span>
        <span class="n">microjson_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># read the tiles and extract the geometries</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">):</span>
                <span class="n">xstart</span> <span class="o">=</span> <span class="n">xstarts</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="n">xstop</span> <span class="o">=</span> <span class="n">xstops</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="n">ystart</span> <span class="o">=</span> <span class="n">ystarts</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
                <span class="n">ystop</span> <span class="o">=</span> <span class="n">ystops</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
                <span class="c1"># format path template with tile coordinates</span>
                <span class="n">tile_file</span> <span class="o">=</span> <span class="n">tilepath</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">zlvl</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tile_file</span><span class="p">)):</span>
                    <span class="k">continue</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">tile_file</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">tile_file</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pbf&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">tile_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="c1"># decode the tile data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbf</span><span class="p">:</span>
                    <span class="n">tile_data</span> <span class="o">=</span> <span class="n">mapbox_vector_tile</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                        <span class="n">tile_data</span><span class="p">,</span>
                        <span class="n">default_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;geojson&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;y_coord_down&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tile_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

                <span class="c1"># dump to file</span>
                <span class="c1"># filename = f&quot;tilevt11_{x}_{y}_{zlvl}.json&quot;</span>

                <span class="c1"># with open(filename, &quot;w&quot;) as f:</span>
                <span class="c1">#    json.dump(tile_data, f)</span>

                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;geojsonLayer&quot;</span><span class="p">]</span>

                <span class="c1"># extract the geometries</span>
                <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">tile_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
                        <span class="c1"># Transform the coordinates to the global coordinate</span>
                        <span class="c1"># system please note that the coordinates may be in</span>
                        <span class="c1"># up to 5 nested lists transform the coordinates in</span>
                        <span class="c1"># place</span>
                        <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">:</span>
                            <span class="n">geom</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
                            <span class="n">coord</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Point&quot;</span><span class="p">:</span>
                                    <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span>
                                        <span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span>
                                    <span class="p">)</span>
                                <span class="k">elif</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LineString&quot;</span><span class="p">:</span>
                                    <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                        <span class="n">project</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                                    <span class="p">]</span>
                                <span class="k">elif</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">:</span>
                                    <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                        <span class="p">[</span>
                                            <span class="n">project</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span><span class="p">)</span>
                                            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ring</span>
                                        <span class="p">]</span>
                                        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                                    <span class="p">]</span>
                                <span class="k">elif</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">:</span>
                                    <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                        <span class="p">[</span>
                                            <span class="p">[</span>
                                                <span class="n">project</span><span class="p">(</span>
                                                    <span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span>
                                                <span class="p">)</span>
                                                <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ring</span>
                                            <span class="p">]</span>
                                            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">poly</span>
                                        <span class="p">]</span>
                                        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                                    <span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">continue</span>

                            <span class="c1"># add the feature to the microjson data</span>
                            <span class="n">microjson_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">return</span> <span class="n">microjson_data</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="microjson.tilereader.TileReader.tiles2microjson" class="doc doc-heading">
            <code class=" language-python"><span class="n">tiles2microjson</span><span class="p">(</span><span class="n">zlvl</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate MicroJSON data from tiles in form of JSON or PBF files.
Get the TileJSON configuration and the PBF flag from the class
attributes.
Check that zlvl is within the maxzoom and minzoom of the tilejson
Get the bounds from the tilejson and use to generate the MicroJSON
data, by reading the tiles at the specified zoom level and
extracting the geometries from the tiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>zlvl</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The zoom level of the tiles to read</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generated MicroJSON data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/tilereader.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tiles2microjson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zlvl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate MicroJSON data from tiles in form of JSON or PBF files.</span>
<span class="sd">    Get the TileJSON configuration and the PBF flag from the class</span>
<span class="sd">    attributes.</span>
<span class="sd">    Check that zlvl is within the maxzoom and minzoom of the tilejson</span>
<span class="sd">    Get the bounds from the tilejson and use to generate the MicroJSON</span>
<span class="sd">    data, by reading the tiles at the specified zoom level and</span>
<span class="sd">    extracting the geometries from the tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        zlvl (int): The zoom level of the tiles to read</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The generated MicroJSON data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check if zlvl is within the maxzoom and minzoom of the tilejson</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">minzoom</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">or</span> <span class="n">zlvl</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">minzoom</span>
        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">or</span> <span class="n">zlvl</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">maxzoom</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># get the bounds from the tilejson</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">bounds</span>
    <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">minx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">ntiles</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">zlvl</span>
    <span class="n">xstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)</span> <span class="o">/</span> <span class="n">ntiles</span>
    <span class="n">ystep</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span> <span class="o">/</span> <span class="n">ntiles</span>
    <span class="n">xstarts</span> <span class="o">=</span> <span class="p">[</span><span class="n">minx</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">xstep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>
    <span class="n">ystarts</span> <span class="o">=</span> <span class="p">[</span><span class="n">miny</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">ystep</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>
    <span class="n">xstops</span> <span class="o">=</span> <span class="p">[</span><span class="n">minx</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">xstep</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>
    <span class="n">ystops</span> <span class="o">=</span> <span class="p">[</span><span class="n">miny</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ystep</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">)]</span>

    <span class="c1"># reverse the ystarts and ystops</span>
    <span class="c1"># ystarts = ystarts[::-1]</span>
    <span class="c1"># ystops = ystops[::-1]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">extent</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">xmin</span><span class="p">),</span>
            <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">extent</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="n">ymin</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="c1"># get the tilepath from the tilejson</span>
    <span class="n">tilepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tile_json</span><span class="o">.</span><span class="n">tiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># initialize the microjson data</span>
    <span class="n">microjson_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># read the tiles and extract the geometries</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntiles</span><span class="p">):</span>
            <span class="n">xstart</span> <span class="o">=</span> <span class="n">xstarts</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">xstop</span> <span class="o">=</span> <span class="n">xstops</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="n">ystart</span> <span class="o">=</span> <span class="n">ystarts</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
            <span class="n">ystop</span> <span class="o">=</span> <span class="n">ystops</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
            <span class="c1"># format path template with tile coordinates</span>
            <span class="n">tile_file</span> <span class="o">=</span> <span class="n">tilepath</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">zlvl</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tile_file</span><span class="p">)):</span>
                <span class="k">continue</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">tile_file</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">tile_file</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pbf&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># decode the tile data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbf</span><span class="p">:</span>
                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">mapbox_vector_tile</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                    <span class="n">tile_data</span><span class="p">,</span>
                    <span class="n">default_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;geojson&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;y_coord_down&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

            <span class="c1"># dump to file</span>
            <span class="c1"># filename = f&quot;tilevt11_{x}_{y}_{zlvl}.json&quot;</span>

            <span class="c1"># with open(filename, &quot;w&quot;) as f:</span>
            <span class="c1">#    json.dump(tile_data, f)</span>

            <span class="n">tile_data</span> <span class="o">=</span> <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;geojsonLayer&quot;</span><span class="p">]</span>

            <span class="c1"># extract the geometries</span>
            <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">tile_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tile_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
                    <span class="c1"># Transform the coordinates to the global coordinate</span>
                    <span class="c1"># system please note that the coordinates may be in</span>
                    <span class="c1"># up to 5 nested lists transform the coordinates in</span>
                    <span class="c1"># place</span>
                    <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">:</span>
                        <span class="n">geom</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
                        <span class="n">coord</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Point&quot;</span><span class="p">:</span>
                                <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span>
                                    <span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span>
                                <span class="p">)</span>
                            <span class="k">elif</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LineString&quot;</span><span class="p">:</span>
                                <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="n">project</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="k">elif</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Polygon&quot;</span><span class="p">:</span>
                                <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="p">[</span>
                                        <span class="n">project</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ring</span>
                                    <span class="p">]</span>
                                    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="k">elif</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MultiPolygon&quot;</span><span class="p">:</span>
                                <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="p">[</span>
                                        <span class="p">[</span>
                                            <span class="n">project</span><span class="p">(</span>
                                                <span class="n">coord</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">ystop</span>
                                            <span class="p">)</span>
                                            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ring</span>
                                        <span class="p">]</span>
                                        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">poly</span>
                                    <span class="p">]</span>
                                    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">continue</span>

                        <span class="c1"># add the feature to the microjson data</span>
                        <span class="n">microjson_data</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">return</span> <span class="n">microjson_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><p>An example of how to use the TileReader module is located in the <code>src/microjson/examples/readtiles.py</code> file of the repository. The example demonstrates how to read binary tiles and convert them back to MicroJSON objects.</p>
<h2 id="tilejson-for-microjson-example-with-vector-layers">TileJSON for MicroJSON example with Vector Layers</h2>
<p>The below example illustrates a TileJSON for a MicroJSON tileset multiple layers of detail. The tileset has a single vector layer, <code>image_layer</code> id of <code>vector_layers</code>, which contains a single vector layer describing images. The <code>fields</code> property of the this layer specifies the attributes of the layer, including the data types of the attributes. The <code>tiles</code> property specifies the URL pattern for accessing the vector tiles, which in this case is a 2D data set (no channels, time or z-axis) with zoom level.</p>
<p>This file is located in the <code>examples/tiles</code> directory of the repository, and is named <code>tiled_example.json</code>. It has a corresponding MicroJSON file for each tile, located in the <code>examples/tiles/tiled_example</code> directory of the repository. The MicroJSON files are organized according to the tiling scheme, with the directory structure <code>zlvl/x/y.json</code> where <code>zlvl</code> is the zoom level, <code>x</code> is the x coordinate, and <code>y</code> is the y coordinate. The MicroJSON files contain the MicroJSON objects for the corresponding tiles, and are named according to the tiling scheme. For example, the MicroJSON object for the tile at zoom level 1, tile at (0,1) in the tiling scheme is located at <code>examples/tiles/tiled_example/1/0/1.json</code>. Examples for MicroJSON objects at zoom levels 0, 1, and 2 are provided below.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;tilejson&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2D Data Example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A tileset showing 2D data with multiple layers of detail.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attribution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;http://example.com&#39;&gt;Example&lt;/a&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;http://example.com/tiled_example/{zlvl}/{x}/{y}.json&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;minzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;maxzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;bounds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">24000</span><span class="p">,</span><span class="w"> </span><span class="mi">24000</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;center&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;vector_layers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tile_layer&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tile layer&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;minzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;maxzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;fillzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;multiscale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;axes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x-axis&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y-axis&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;transformationMatrix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">                </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">                </span><span class="mf">0.0</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">                </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">                </span><span class="mf">0.0</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">                </span><span class="mf">0.0</span><span class="p">,</span>
<span class="w">                </span><span class="mf">0.0</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="tiled-binary-tilejson">Tiled binary TileJSON</h2>
<p>In addition to json format, tiles may be encoded in a binary protobuf format. Below follows a similar example to the one above, but with binary tiles. The <code>tiles</code> property specifies the URL pattern for accessing the binary tiles, which in this case is a 2D data set (no channels, time or z-axis) with zoom level. The <code>fillzoom</code> property specifies the zoom level from which to generate overzoomed tiles, which in this case starts at level 3, after the last specified layer.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;tilejson&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2D Data Example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A tileset showing 2D data with multiple layers of detail.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attribution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;http://example.com&#39;&gt;Example&lt;/a&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;http://example.com/tiled_example/{zlvl}/{x}/{y}.pbf&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;minzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;maxzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;bounds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">24000</span><span class="p">,</span><span class="w"> </span><span class="mi">24000</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;center&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;vector_layers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tile_layer&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tile layer&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;minzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;maxzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;fieldranges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
<span class="w">              </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;fieldenums&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;A2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B2&quot;</span><span class="p">],</span>
<span class="w">              </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;image1.tif&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;image2.tif&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;image3.tif&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nt">&quot;fielddescriptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Well plate identifier&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Image filename&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Label identifier&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Channel identifier&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;fillzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="tiled-binary-example">Tiled binary example</h2>
<p>The examples folder contains an example of how to generate binary tiles from one large MicroJSON file. It uses a helper module that generates a large random polygon grid, as could be expected in an imaging setting, using typical imaging coordinates. It is also included below for reference.</p>
<h3 id="example-of-creating-binary-tiles-from-a-large-microjson-file">Example of creating binary tiles from a large MicroJSON file</h3>


<div class="doc doc-object doc-function">



<a id="microjson.examples.tiling.main"></a>
    <div class="doc doc-contents first">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/microjson/examples/tiling.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;microjson_data_path&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the MicroJSON data file&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">microjson_data_path</span><span class="p">:</span>
        <span class="n">microjson_data_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">microjson_data_path</span>
        <span class="n">do_generate</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Extract fields, ranges, enums from the provided MicroJSON</span>
        <span class="n">field_names</span><span class="p">,</span> <span class="n">field_ranges</span><span class="p">,</span> <span class="n">field_enums</span> <span class="o">=</span> <span class="n">extract_fields_ranges_enums</span><span class="p">(</span>
            <span class="n">microjson_data_path</span><span class="p">)</span>

        <span class="c1"># Create a TileLayer including the extracted fields</span>
        <span class="n">vector_layers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TileLayer</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;extracted-layer&quot;</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="n">field_names</span><span class="p">,</span>
                <span class="n">minzoom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">maxzoom</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Layer with extracted fields&quot;</span><span class="p">,</span>
                <span class="n">fieldranges</span><span class="o">=</span><span class="n">field_ranges</span><span class="p">,</span>
                <span class="n">fieldenums</span><span class="o">=</span><span class="n">field_enums</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">microjson_data_path</span> <span class="o">=</span> <span class="s2">&quot;example.json&quot;</span>
        <span class="n">do_generate</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># clear the tiles directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -rf tiles&quot;</span><span class="p">)</span>

    <span class="c1"># create the tiles directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;tiles&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">do_generate</span><span class="p">:</span>
        <span class="c1"># Create a microjson file with random polygons</span>
        <span class="n">GRID_SIZE</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">CELL_SIZE</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">MIN_VERTICES</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">MAX_VERTICES</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">meta_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;num_vertices&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">meta_values_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;polytype&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Type1&quot;</span><span class="p">,</span> <span class="s2">&quot;Type2&quot;</span><span class="p">,</span> <span class="s2">&quot;Type3&quot;</span><span class="p">,</span> <span class="s2">&quot;Type4&quot;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">vector_layers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TileLayer</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;polygon-layer&quot;</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="s2">&quot;polytype&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">},</span>
                <span class="n">minzoom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">maxzoom</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Layer containing polygon data&quot;</span><span class="p">,</span>
                <span class="n">fieldranges</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;num_vertices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="n">fieldenums</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;polytype&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Type1&quot;</span><span class="p">,</span> <span class="s2">&quot;Type2&quot;</span><span class="p">,</span> <span class="s2">&quot;Type3&quot;</span><span class="p">,</span> <span class="s2">&quot;Type4&quot;</span><span class="p">]</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="n">generate_polygons</span><span class="p">(</span>
            <span class="n">GRID_SIZE</span><span class="p">,</span>
            <span class="n">CELL_SIZE</span><span class="p">,</span>
            <span class="n">MIN_VERTICES</span><span class="p">,</span>
            <span class="n">MAX_VERTICES</span><span class="p">,</span>
            <span class="n">meta_types</span><span class="p">,</span>
            <span class="n">meta_values_options</span><span class="p">,</span>
            <span class="n">microjson_data_path</span>
        <span class="p">)</span>

    <span class="c1"># get bounds</span>
    <span class="n">maxbounds</span> <span class="o">=</span> <span class="n">getbounds</span><span class="p">(</span><span class="n">microjson_data_path</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span>
              <span class="p">(</span><span class="n">maxbounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">maxbounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
              <span class="p">(</span><span class="n">maxbounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">maxbounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Instantiate TileModel with your settings</span>
    <span class="n">tile_model</span> <span class="o">=</span> <span class="n">TileModel</span><span class="p">(</span>
        <span class="n">tilejson</span><span class="o">=</span><span class="s2">&quot;3.0.0&quot;</span><span class="p">,</span>
        <span class="n">tiles</span><span class="o">=</span><span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;tiles/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">.pbf&quot;</span><span class="p">)],</span>  <span class="c1"># Local path or URL</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Example Tile Layer&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A TileJSON example incorporating MicroJSON data&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
        <span class="n">attribution</span><span class="o">=</span><span class="s2">&quot;Polus AI&quot;</span><span class="p">,</span>
        <span class="n">minzoom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">maxzoom</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="n">maxbounds</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
        <span class="n">vector_layers</span><span class="o">=</span><span class="n">vector_layers</span>
    <span class="p">)</span>

    <span class="c1"># Create the root model with your TileModel instance</span>
    <span class="n">tileobj</span> <span class="o">=</span> <span class="n">TileJSON</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">tile_model</span><span class="p">)</span>

    <span class="c1"># export to tilejson</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;tiles&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;tiles/metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tileobj</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Initialize the TileHandler</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">TileWriter</span><span class="p">(</span><span class="n">tile_model</span><span class="p">,</span> <span class="n">pbf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">microjson2tiles</span><span class="p">(</span><span class="n">microjson_data_path</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="tiled-microjson-example">Tiled MicroJSON Example</h2>
<h3 id="level-0">Level 0</h3>
<p>The following is an example of a MicroJSON object at zoom level 0, tile at (0,0) in the tiling scheme. Example URL: <code>http://example.com/tiles/0/0/0.json</code></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;tilejson&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2D Data Example&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A tileset showing 2D data with multiple layers of detail.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attribution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;http://example.com&#39;&gt;Example&lt;/a&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;http://example.com/tiled_example/{zlvl}/{x}/{y}.json&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;minzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;maxzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;bounds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">24000</span><span class="p">,</span><span class="w"> </span><span class="mi">24000</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;center&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;vector_layers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_layer&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Image layer&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;minzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;maxzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Number&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;fillzoom&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="level-1">Level 1</h3>
<p>The following is an example of a MicroJSON object at zoom level 1, tile at (0,1) in the tiling scheme. Example URL: <code>http://example.com/tiles/1/0/1.json</code></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;geometry&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="mi">10000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">10000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">20000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="mi">20000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="mi">10000</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;multiscale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;axes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x-axis&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y-axis&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x00_y01_p01_c1.ome.tif&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="level-2">Level 2</h3>
<p>The following is an example of a MicroJSON object at zoom level 2, tile at (1,1) in the tiling scheme. Example URL: <code>http://example.com/tiles/2/1/3.json</code></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;geometry&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Polygon&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">5000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">15000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">15000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">20000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">5000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">20000</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">              </span><span class="mi">5000</span><span class="p">,</span>
<span class="w">              </span><span class="mi">15000</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;multiscale&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;axes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x-axis&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;space&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;micrometer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y-axis&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;plate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x00_y01_p01_c1.ome.tif&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      (c) 2023 PolusAI
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/json.min.js"></script>
      
        <script src="../init_highlight.js"></script>
      
    
  </body>
</html>